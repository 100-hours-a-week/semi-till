# TIL

## 날짜: 2024-12-04

### 스크럼

- 학습 목표 1 : FE/BE 테스트 🔥🔥
- 학습 목표 2:  딥다이브 ✅

### 새로 배운 내용

## 1️⃣주제 1: API Gateway + Load Balancer

## API Gateway

- 클라이언트와 백엔드 서비스 사이에 **중개자 역할**을 하는 소프트웨어 구성 요소 중 하나.
    
    ⇒ **쉽게 말하면 API가 지나가는 통로**
    
- **마이크로서비스 아키텍처에서** 필수적인 구성 요소이다.
    
    >**마이크로 서비스 (MSA)**
    >
    >1. **소프트웨어 시스템을 ‘독립적인 서비스’로 분할하여 개발하고 배포하는 방식**
    >2. **각각 별도의 서버나 컨테이너에서 실행**
    >3.  **각 서비스는 서비스에 적합한 기술 스택을 선택할 수 있다.**
    >4. **업데이트, 확장에 용이하다.**
    

### ✅ API Gateway 주요 기능

1. **요청 라우팅 관리**
2. **보안 강화**
3. **속도 제한**
4. **프로토콜 변환**
5. **캐싱**
6. **로깅**

### 1️⃣요청 라우팅 관리

1. 클라이언트로부터 들어온 모든 API 요청을 수신
2. 특정 조건(URL, HTTP 메서드, header)에 따라 적합한 백엔드 서비스로 라우팅
    
    ex) /products → 제품 조회 서비스 , /cart →장바구니 서비스로 요청 전달
    

### 2️⃣보안 강화

1. 모든 보안 정책을(인증/ 인가) 기능을 한 곳(API Gateway)에서 관리 할 수 있다. → 일관된 보안 정책 적용 가능
    
    ※ 각 서버 별로 보안 기능을 구현할 수 있음 → 보안 방식 변경 시 일일이 수정해야함 → 👎
    

### 3️⃣속도 제한

1. IP /사용자 별로 요청 횟수 제한
2. 과도한 요청 방지 → API 트래픽을 효율적으로 관리한다. 

### 4️⃣프로토콜 변환

1. 클라이언트와 백엔드가 서로 다른 프로토콜과 데이터 형식을 사용하더라도 프로토콜을 변환하여 통신을 가능하게 한다.
    
    ex) Web socket ↔ HTTP
    
    ex) Iot 장치가 MQTT 프로토콜로 데이터 전송 → **(API Gateway : HTTP/REST으로 변환)** → 클라우드: HTTP로 수신
    

### 5️⃣캐싱

1. 자주 요청되는 API 응답을 캐싱하여 백엔드 서버에 부하를 줄일 수 있다.
    
    ex) 제품 목록  데이터 : API Gateway에서 캐싱하여 백엔드 서비스에 반복 요청하지 않도록 설정
    

### 6️⃣로깅

1. 요청/응답 로그 (요청,응답 헤더, 호출시간/지연시간)
2. 오류 로그 (인증 실패, 백엔드 장애)
3. 트래픽 로그 (초당 요청 처리량, 특정 클라이언트에게 발생한 트래픽)]

⇒ **운영, 보안 관리에 도움이 될 수 있다.**

## API Gateway를 언제 사용하면 좋을까?

### **마이크로서비스 아키텍처**

1. 여러 개의 서비스가 독립적으로 운영된다.
2. API Gateway를 사용하면, 클라이언트가 각각의 서비스를 직접 연결하지 않아도 gateway를 통해 하나의 entry point로 진입할 수 있다.

## Load Balancer와의 공통점 차이점

### **load balancer**

네트워크 트래픽을 **여러 서버에 균등하게 분산**시키는 장치/소프트웨어

- **트래픽 분산**
    - 클라이언트에서 들어오는 요청을 여러 서버에 분산하여 특정 서버에 과부하가 걸리지 않도록 한다.
    - ex) 1000개의 요청이 들어오면, 10개의 서버에 각각 100개씩 요청을 분산시킨다.
- **Health Check**
    - 주기적으로 서버가 정상 작동 중인지 확인한다. → 정상 작동 중인 서버로만 트래픽 전송
    - 서버가 다운 되더라도 나머지 서버로 서비스를 계속 운영하도록 하므로 고가용성을 보장한다.
- **세션 유지**
    - 로드 밸런서에서 클라이언트의 세션 정보 기억 → 클라이언트의 모든 요청을 동일한 백엔드 서버로 전송
    - 예: 로그인 상태 유지, 장바구니

### 공통점

1. **시스템 성능 향상**
    
    : 시스템의 전반적인 성능을 향상 시킨다.
    
2. **트래픽 분산**
    
    : 들어오는 요청을 받아 적절한 서버로 트래픽을 분산 시킨다.
    
3. **수평 확장 가능**
    
    : API Gateway  인스턴스를 추가 / 서버 인스턴스 추가ㅂㅂ
    

### 차이점

- **Load Balancer** : 서버 트래픽 분산 기능에 중점
- **API Gateway** : 서비스 간 중앙 통신, API ‘관리’에 중점

| **항목** | **API Gateway** | **Load Balancer** |
| --- | --- | --- |
| **주요 목적** | API 요청을 수집하고, 라우팅, 인증, 보안 등 처리 | 네트워크 트래픽을 균등하게 여러 서버로 분산 |
| **계층** | 애플리케이션 계층(L7) | L4 (TCP/UDP) 또는 L7 (HTTP/HTTPS) |
| **기능.** | 인증/인가, 속도 제한, 프로토콜 변환, API 로깅, 캐싱 | 트래픽 분산, 장애 조치, SSL 종료 |
| **보안 기능** | 인증, 인가, DDoS 방어 등 보안 기능 제공 | 기본 보안(SSL 암호화 등), 세션 유지 |
| **세부 트래픽 제어** | API 엔드포인트별로 세부 제어 가능 | IP, 포트 기반 또는 URL 패턴에 따른 트래픽 분산 |
| **프로토콜 변환.** | 예: HTTP ↔ WebSocket, XML ↔ JSON 변환 지원 | 변환기능 x |
| **로깅.** | API 요청에 대한 로깅을 지원, 요청의 경과 및 처리 시간 기록 | 로깅 기능은 보통 x |
| **캐싱.** | 요청에 대한 응답을 캐시하여 성능 최적화 가능 | 캐싱 기능 x |

### 결론

API Gateway와 Load Balancer를 같이 사용하면 부하 분산 + 효율적인 요청 처리를 할 수 있다.

- Load Balancer : 서버 트래픽 분산
- api gateway :  요청 라우팅, 보안 기능
1. 클라이언트 → **로드 밸런서** → **API Gateway** → 백엔드 서비스
2. 클라이언트 → **API Gateway** → **로드 밸런서** → 백엔드 서비스

### 오늘의 회고

오늘도 하나의 주제를 꾸준히 공부하는 것은 힘들면서도 뿌듯하다.. API Gateway가 언제 사용하는 것인지 헷갈렸는데, 이번 기회에 정리할 수 있어서 뜻 깊은 시간이였다.
